<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Kapitel 3 Datamanipulering med dplyr | Kursmaterial Introduktion till R - Certifierad Data Scientist</title>
  <meta name="description" content="Här finns kursmaterial och övningar för första blocket R-övningar." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Kapitel 3 Datamanipulering med dplyr | Kursmaterial Introduktion till R - Certifierad Data Scientist" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Här finns kursmaterial och övningar för första blocket R-övningar." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Kapitel 3 Datamanipulering med dplyr | Kursmaterial Introduktion till R - Certifierad Data Scientist" />
  
  <meta name="twitter:description" content="Här finns kursmaterial och övningar för första blocket R-övningar." />
  

<meta name="author" content="Filip Wästberg &amp; Torbjörn Sjöberg, Solita" />


<meta name="date" content="2020-11-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="eda.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Kursmaterial Certifierad Data Scientist</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Om dokumentet</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduktion till R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#saknade-värden-missing-values"><i class="fa fa-check"></i><b>2.1</b> Saknade värden (missing values)</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#r-är-ett-funktionellt-programmeringsspråk"><i class="fa fa-check"></i><b>2.2</b> R är ett funktionellt programmeringsspråk</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#funktioner"><i class="fa fa-check"></i><b>2.2.1</b> Funktioner</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#dokumentation-av-funktioner"><i class="fa fa-check"></i><b>2.2.2</b> Dokumentation av funktioner</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#övning"><i class="fa fa-check"></i><b>2.2.3</b> Övning</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#data-frames"><i class="fa fa-check"></i><b>2.3</b> Data frames</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#paket"><i class="fa fa-check"></i><b>2.4</b> Paket</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#övning-1"><i class="fa fa-check"></i><b>2.4.1</b> Övning</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#tidyverse-and-friends"><i class="fa fa-check"></i><b>2.5</b> tidyverse and friends</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#workflow-i-r"><i class="fa fa-check"></i><b>2.6</b> Workflow i R</a></li>
<li class="chapter" data-level="2.7" data-path="intro.html"><a href="intro.html#att-skriva-kod-i-r"><i class="fa fa-check"></i><b>2.7</b> Att skriva kod i R</a></li>
<li class="chapter" data-level="2.8" data-path="intro.html"><a href="intro.html#rmarkdown"><i class="fa fa-check"></i><b>2.8</b> Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="databearbetning.html"><a href="databearbetning.html"><i class="fa fa-check"></i><b>3</b> Datamanipulering med dplyr</a>
<ul>
<li class="chapter" data-level="3.1" data-path="databearbetning.html"><a href="databearbetning.html#filter"><i class="fa fa-check"></i><b>3.1</b> Filter</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="intro.html"><a href="intro.html#övning"><i class="fa fa-check"></i><b>3.1.1</b> Övning</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="databearbetning.html"><a href="databearbetning.html#arrange"><i class="fa fa-check"></i><b>3.2</b> Arrange</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="intro.html"><a href="intro.html#övning-1"><i class="fa fa-check"></i><b>3.2.1</b> Övning</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="databearbetning.html"><a href="databearbetning.html#select"><i class="fa fa-check"></i><b>3.3</b> Select</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="databearbetning.html"><a href="databearbetning.html#övning-2"><i class="fa fa-check"></i><b>3.3.1</b> Övning</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="databearbetning.html"><a href="databearbetning.html#mutate"><i class="fa fa-check"></i><b>3.4</b> Mutate</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="databearbetning.html"><a href="databearbetning.html#if_else"><i class="fa fa-check"></i><b>3.4.1</b> if_else()</a></li>
<li class="chapter" data-level="3.4.2" data-path="databearbetning.html"><a href="databearbetning.html#andra-funktioner"><i class="fa fa-check"></i><b>3.4.2</b> Andra funktioner</a></li>
<li class="chapter" data-level="3.4.3" data-path="databearbetning.html"><a href="databearbetning.html#övningar"><i class="fa fa-check"></i><b>3.4.3</b> Övningar</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="databearbetning.html"><a href="databearbetning.html#summarise"><i class="fa fa-check"></i><b>3.5</b> Summarise</a></li>
<li class="chapter" data-level="3.6" data-path="databearbetning.html"><a href="databearbetning.html#sample_n"><i class="fa fa-check"></i><b>3.6</b> sample_n()</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="databearbetning.html"><a href="databearbetning.html#övning-3"><i class="fa fa-check"></i><b>3.6.1</b> Övning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>4</b> Explorativ dataanalys</a>
<ul>
<li class="chapter" data-level="4.1" data-path="eda.html"><a href="eda.html#vad-är-explorativ-dataanalys"><i class="fa fa-check"></i><b>4.1</b> Vad är Explorativ Dataanalys?</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="eda.html"><a href="eda.html#exempel-på-basala-frågorhypoteser"><i class="fa fa-check"></i><b>4.1.1</b> Exempel på basala frågor/hypoteser</a></li>
<li class="chapter" data-level="4.1.2" data-path="eda.html"><a href="eda.html#hur-gör-man-i-r"><i class="fa fa-check"></i><b>4.1.2</b> Hur gör man i R?</a></li>
<li class="chapter" data-level="4.1.3" data-path="eda.html"><a href="eda.html#hur-gör-man-i-r-1"><i class="fa fa-check"></i><b>4.1.3</b> Hur gör man i R?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="eda.html"><a href="eda.html#datavisualisering"><i class="fa fa-check"></i><b>4.2</b> Datavisualisering</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="eda.html"><a href="eda.html#varför-visualisera"><i class="fa fa-check"></i><b>4.2.1</b> Varför visualisera?</a></li>
<li class="chapter" data-level="4.2.2" data-path="eda.html"><a href="eda.html#vad-är-det-första-vi-gör"><i class="fa fa-check"></i><b>4.2.2</b> Vad är det första vi gör?</a></li>
<li class="chapter" data-level="4.2.3" data-path="eda.html"><a href="eda.html#steg-2-anpassar-en-linjär-modell"><i class="fa fa-check"></i><b>4.2.3</b> Steg 2: anpassar en linjär modell</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="eda.html"><a href="eda.html#datasaurus-dozen"><i class="fa fa-check"></i><b>4.3</b> Datasaurus Dozen</a></li>
<li class="chapter" data-level="4.4" data-path="eda.html"><a href="eda.html#workflow-för-nytt-dataset"><i class="fa fa-check"></i><b>4.4</b> Workflow för nytt dataset</a></li>
<li class="chapter" data-level="4.5" data-path="eda.html"><a href="eda.html#gapminder"><i class="fa fa-check"></i><b>4.5</b> Gapminder</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="eda.html"><a href="eda.html#datapunkter-per-land"><i class="fa fa-check"></i><b>4.5.1</b> Datapunkter per land?</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="eda.html"><a href="eda.html#grammar-of-grahics"><i class="fa fa-check"></i><b>4.6</b> Grammar of grahics</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="eda.html"><a href="eda.html#data"><i class="fa fa-check"></i><b>4.6.1</b> 1. Data</a></li>
<li class="chapter" data-level="4.6.2" data-path="eda.html"><a href="eda.html#aesthetics"><i class="fa fa-check"></i><b>4.6.2</b> 2. Aesthetics</a></li>
<li class="chapter" data-level="4.6.3" data-path="eda.html"><a href="eda.html#geometriska-objekt"><i class="fa fa-check"></i><b>4.6.3</b> 3. Geometriska objekt</a></li>
<li class="chapter" data-level="4.6.4" data-path="eda.html"><a href="eda.html#skala"><i class="fa fa-check"></i><b>4.6.4</b> 4. Skala</a></li>
<li class="chapter" data-level="4.6.5" data-path="eda.html"><a href="eda.html#gdp-per-capita-är-skevt-fördelad"><i class="fa fa-check"></i><b>4.6.5</b> GDP per capita är skevt fördelad</a></li>
<li class="chapter" data-level="4.6.6" data-path="eda.html"><a href="eda.html#statistiska-beräkningar"><i class="fa fa-check"></i><b>4.6.6</b> 5. Statistiska beräkningar</a></li>
<li class="chapter" data-level="4.6.7" data-path="eda.html"><a href="eda.html#facets"><i class="fa fa-check"></i><b>4.6.7</b> 6. Facets</a></li>
<li class="chapter" data-level="4.6.8" data-path="eda.html"><a href="eda.html#koordinatsystem"><i class="fa fa-check"></i><b>4.6.8</b> 7. Koordinatsystem</a></li>
<li class="chapter" data-level="4.6.9" data-path="eda.html"><a href="eda.html#grammar-of-graphics"><i class="fa fa-check"></i><b>4.6.9</b> Grammar of graphics</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="eda.html"><a href="eda.html#gapminder---fortsättning"><i class="fa fa-check"></i><b>4.7</b> Gapminder - fortsättning</a></li>
<li class="chapter" data-level="4.8" data-path="eda.html"><a href="eda.html#eda-är-en-nyfiken-process-utan-slut"><i class="fa fa-check"></i><b>4.8</b> EDA är en nyfiken process utan slut!</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="eda.html"><a href="eda.html#det-ni-ska-ta-med-er-idag-är-inte-de-specifika-sakerna-vi-har-undersökt-utan-ett-mindset"><i class="fa fa-check"></i><b>4.8.1</b> Det ni ska ta med er idag är inte de specifika sakerna vi har undersökt, utan ett mindset!</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="eda.html"><a href="eda.html#länkar-till-resurser"><i class="fa fa-check"></i><b>4.9</b> Länkar till resurser</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bilaga.html"><a href="bilaga.html"><i class="fa fa-check"></i><b>5</b> Bilaga</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bilaga.html"><a href="bilaga.html#variabeltyper-i-r"><i class="fa fa-check"></i><b>5.1</b> Variabeltyper i R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="bilaga.html"><a href="bilaga.html#vektorer"><i class="fa fa-check"></i><b>5.1.1</b> Vektorer</a></li>
<li class="chapter" data-level="5.1.2" data-path="bilaga.html"><a href="bilaga.html#faktorvariabel"><i class="fa fa-check"></i><b>5.1.2</b> Faktorvariabel</a></li>
<li class="chapter" data-level="5.1.3" data-path="bilaga.html"><a href="bilaga.html#logik"><i class="fa fa-check"></i><b>5.1.3</b> Logik</a></li>
<li class="chapter" data-level="5.1.4" data-path="bilaga.html"><a href="bilaga.html#matriser"><i class="fa fa-check"></i><b>5.1.4</b> Matriser</a></li>
<li class="chapter" data-level="5.1.5" data-path="bilaga.html"><a href="bilaga.html#data.frame"><i class="fa fa-check"></i><b>5.1.5</b> Data.frame</a></li>
<li class="chapter" data-level="5.1.6" data-path="bilaga.html"><a href="bilaga.html#listor"><i class="fa fa-check"></i><b>5.1.6</b> Listor</a></li>
<li class="chapter" data-level="5.1.7" data-path="bilaga.html"><a href="bilaga.html#datum"><i class="fa fa-check"></i><b>5.1.7</b> Datum</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bilaga.html"><a href="bilaga.html#indexering"><i class="fa fa-check"></i><b>5.2</b> Indexering</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="bilaga.html"><a href="bilaga.html#genom-att-begränsa-värden-som-man-vill-plocka-ut"><i class="fa fa-check"></i><b>5.2.1</b> Genom att begränsa värden som man vill plocka ut</a></li>
<li class="chapter" data-level="5.2.2" data-path="bilaga.html"><a href="bilaga.html#genom-att-ange-namn-av-elementet-eller-kolumnen"><i class="fa fa-check"></i><b>5.2.2</b> Genom att ange namn av elementet eller kolumnen</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Kursmaterial Introduktion till R - Certifierad Data Scientist</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="databearbetning" class="section level1" number="3">
<h1><span class="header-section-number">Kapitel 3</span> Datamanipulering med dplyr</h1>
<p>Det sägs ofta att en Data Scientist ägnar 80% av sin tid till att manipulera data så att den går att visualisera och modellera. Därför är det klokt att välja en metod och ett paket som underlättar det arbetet för dig.</p>
<p>I den här introduktionen kommer vi att fokusera på att använda paketet <code>dplyr</code> för att göra datamanipuleringar. <code>dplyr</code> är ett av de mest populära paketen i R och ger dig en bred verktygslåda för att manipulera data. <code>dplyr</code> ingår också i ett samlingspaket <code>tidyverse</code> och samlar flertalet paket för datamanipulering, visualisering och modellering.</p>
<p><code>dplyr</code> har ett antal <em>verb</em> för att göra manipuleringar:</p>
<ul>
<li><strong><code>filter()</code></strong> där du väljer observationer baserat på deras värden</li>
<li><strong><code>arrange()</code></strong> som ändrar ordningen på rader</li>
<li><strong><code>select()</code></strong> för att välja variabler baserat på deras namn</li>
<li><strong><code>mutate()</code></strong> för att skapa nya variabler baserat på funktioner</li>
<li><strong><code>summarise()</code></strong> för att summera många värden till ett värde</li>
</ul>
<p>Samtliga av dessa verb kan användas i kombination med funktionen <code>group_by()</code> som innebär att du utför verben på flera grupper.</p>
<p>Alla verb i <code>dplyr</code> är konsekventa. Det första argumentet är din data och i det andra argumentet specificerar du vad du vill göra med din data. Resultatet är alltid en ny data.frame.</p>
<div id="filter" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Filter</h2>
<p>Med filter kan du enkelt filtrera din data baserat på villkor.</p>
<p>Dessa villkor uttrycks med hjälp av <code>relationsoperatorer</code> och <code>logical operators</code>.</p>
<p>I R är dessa:</p>
<table>
<thead>
<tr class="header">
<th align="left">Relationsoperator</th>
<th align="left">Symbol i R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">och (and)</td>
<td align="left">&amp;</td>
</tr>
<tr class="even">
<td align="left">eller(or)</td>
<td align="left">|</td>
</tr>
<tr class="odd">
<td align="left">icke(not)</td>
<td align="left">!</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="left">Logical Operators</th>
<th align="left">Symbol i R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">lika</td>
<td align="left">==</td>
</tr>
<tr class="even">
<td align="left">inte lika</td>
<td align="left">!=</td>
</tr>
<tr class="odd">
<td align="left">större än eller lika</td>
<td align="left">&gt;=</td>
</tr>
<tr class="even">
<td align="left">mindre än eller lika</td>
<td align="left">&lt;=</td>
</tr>
<tr class="odd">
<td align="left">större än</td>
<td align="left">&gt;</td>
</tr>
<tr class="even">
<td align="left">mindre än</td>
<td align="left">&lt;</td>
</tr>
<tr class="odd">
<td align="left">finns i</td>
<td align="left">%in%</td>
</tr>
</tbody>
</table>
<p>Dessa kan du använda i <code>filter()</code>.</p>
<p><strong>PS: Det vanligaste misstaget i början av din R-karriär är att skriva <code>=</code> istället för <code>==</code>.</strong></p>
<p>Så här använder du operatorerna:</p>
<p>Hitta alla flyg som kom fram 08:30 under februari</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="databearbetning.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb41-2"><a href="databearbetning.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb41-3"><a href="databearbetning.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, month <span class="sc">==</span> <span class="dv">2</span>, arr_time <span class="sc">==</span> <span class="dv">830</span>)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     2     2      656            700        -4      830            839
## 2  2013     2     4      652            600        52      830            759
## 3  2013     2     6      629            630        -1      830            845
## 4  2013     2    13      633            636        -3      830            808
## 5  2013     2    18      717            700        17      830            832
## 6  2013     2    24      557            600        -3      830            837
## 7  2013     2    25      532            540        -8      830            850
## 8  2013     2    26      615            615         0      830            820
## 9  2013     2    28      621            630        -9      830            830
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Hitta alla flygbolag som finns i <code>c("UA", "DL")</code> i februari eller mars och som inte var försenade.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="databearbetning.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights, carrier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;UA&quot;</span>, <span class="st">&quot;DL&quot;</span>), month <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> month <span class="sc">==</span> <span class="dv">3</span>, dep_delay <span class="sc">&lt;=</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10,346 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     2     1      520            525        -5      816            820
##  2  2013     2     1      527            530        -3      837            829
##  3  2013     2     1      554            601        -7      920            918
##  4  2013     2     1      558            600        -2      738            759
##  5  2013     2     1      559            600        -1      923            925
##  6  2013     2     1      600            600         0      833            837
##  7  2013     2     1      601            608        -7      703            725
##  8  2013     2     1      601            608        -7      723            755
##  9  2013     2     1      604            610        -6      752            817
## 10  2013     2     1      608            615        -7      837            842
## # … with 10,336 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="övning" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Övning</h3>
<p>Hur många plan…</p>
<ol style="list-style-type: decimal">
<li>var försenade mer än 1 timme?</li>
<li>skulle till Boston (“BOS”)</li>
<li>lämnade JFK och var försenade</li>
<li>lämnade JFK på julafton</li>
<li>var försenade, men inte kom fram försent</li>
<li>flög United Airlines (UA) eller American Airlines?</li>
</ol>
</div>
</div>
<div id="arrange" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Arrange</h2>
<p><code>arrange()</code> kastar om ordningen på dina rader enligt en av dig vald variabel. Exempelvis kanske vi vill sortera data på försenade avgångar <code>dep_delay</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="databearbetning.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, dep_delay)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    12     7     2040           2123       -43       40           2352
##  2  2013     2     3     2022           2055       -33     2240           2338
##  3  2013    11    10     1408           1440       -32     1549           1559
##  4  2013     1    11     1900           1930       -30     2233           2243
##  5  2013     1    29     1703           1730       -27     1947           1957
##  6  2013     8     9      729            755       -26     1002            955
##  7  2013    10    23     1907           1932       -25     2143           2143
##  8  2013     3    30     2030           2055       -25     2213           2250
##  9  2013     3     2     1431           1455       -24     1601           1631
## 10  2013     5     5      934            958       -24     1225           1309
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><code>arrange()</code> sorterar per default på sjunkande värde (ascending). Vill du sortera på stigande värde (descending) sätter du <code>desc()</code> runt din variabel.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="databearbetning.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights, <span class="fu">desc</span>(dep_delay))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242           1530
##  2  2013     6    15     1432           1935      1137     1607           2120
##  3  2013     1    10     1121           1635      1126     1239           1810
##  4  2013     9    20     1139           1845      1014     1457           2210
##  5  2013     7    22      845           1600      1005     1044           1815
##  6  2013     4    10     1100           1900       960     1342           2211
##  7  2013     3    17     2321            810       911      135           1020
##  8  2013     6    27      959           1900       899     1236           2226
##  9  2013     7    22     2257            759       898      121           1026
## 10  2013    12     5      756           1700       896     1058           2020
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="övning-1" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Övning</h3>
<p>Hitta det flyg som…</p>
<ol style="list-style-type: decimal">
<li>flög längst</li>
<li>var mest försenat (när det kom fram)</li>
</ol>
</div>
</div>
<div id="select" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Select</h2>
<p>Medan <code>arrange()</code> kastar om raderna så kastar <code>select()</code> om kolumnerna. Men mest används den för att välja ut kolumner av intresse.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="databearbetning.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, dep_delay, carrier)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    dep_delay carrier
##        &lt;dbl&gt; &lt;chr&gt;  
##  1         2 UA     
##  2         4 UA     
##  3         2 AA     
##  4        -1 B6     
##  5        -6 DL     
##  6        -4 UA     
##  7        -5 B6     
##  8        -3 EV     
##  9        -3 B6     
## 10        -2 AA     
## # … with 336,766 more rows</code></pre>
<p>Om du av något skäl vill flytta en kolumn till början kan du skriva:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="databearbetning.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, carrier, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##    carrier  year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1 UA       2013     1     1      517            515         2      830
##  2 UA       2013     1     1      533            529         4      850
##  3 AA       2013     1     1      542            540         2      923
##  4 B6       2013     1     1      544            545        -1     1004
##  5 DL       2013     1     1      554            600        -6      812
##  6 UA       2013     1     1      554            558        -4      740
##  7 B6       2013     1     1      555            600        -5      913
##  8 EV       2013     1     1      557            600        -3      709
##  9 B6       2013     1     1      557            600        -3      838
## 10 AA       2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 11 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Du kan även välja alla kolumner mellan två kolumner:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="databearbetning.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, year<span class="sc">:</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows</code></pre>
<p>Genom att sätta ett minus framför variabelnamnet exkluderar du variabeln.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="databearbetning.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, <span class="sc">-</span>year)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 18
##    month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1     1     1      517            515         2      830            819
##  2     1     1      533            529         4      850            830
##  3     1     1      542            540         2      923            850
##  4     1     1      544            545        -1     1004           1022
##  5     1     1      554            600        -6      812            837
##  6     1     1      554            558        -4      740            728
##  7     1     1      555            600        -5      913            854
##  8     1     1      557            600        -3      709            723
##  9     1     1      557            600        -3      838            846
## 10     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="select-plus-hjälpfunktioner" class="section level4" number="3.3.0.1">
<h4><span class="header-section-number">3.3.0.1</span> select() plus hjälpfunktioner</h4>
<p><code>select()</code> kommer med ett antal hjälpfunktioner:</p>
<ul>
<li><code>starts_with("asd")</code></li>
<li><code>ends_with("air")</code></li>
<li><code>contains("flyg")</code></li>
<li><code>matches("asd")</code></li>
<li><code>num_range("flyg", 1:10)</code></li>
</ul>
<p>De används för att identifiera kolumner baserat på text.</p>
<p>Exempelvis kan du hitta alla delay-kolumner med <code>contains</code>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="databearbetning.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights, <span class="fu">contains</span>(<span class="st">&quot;delay&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    dep_delay arr_delay
##        &lt;dbl&gt;     &lt;dbl&gt;
##  1         2        11
##  2         4        20
##  3         2        33
##  4        -1       -18
##  5        -6       -25
##  6        -4        12
##  7        -5        19
##  8        -3       -14
##  9        -3        -8
## 10        -2         8
## # … with 336,766 more rows</code></pre>
</div>
<div id="rename" class="section level4" number="3.3.0.2">
<h4><span class="header-section-number">3.3.0.2</span> rename()</h4>
<p>En annan nyttig funktion är <code>rename()</code> som kort och gott döper om variabler.</p>
<p>Formeln är <code>rename(data, ny_variabel = gammal_variabel)</code></p>
</div>
<div id="övning-2" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Övning</h3>
<ol style="list-style-type: decimal">
<li>Som innehåller “dep”</li>
<li>Som börjar med “dep”</li>
<li>Döp om <code>dep_delay</code> till <code>försenad_avgång</code></li>
</ol>
</div>
</div>
<div id="mutate" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Mutate</h2>
<p><code>mutate()</code> används för att skapa nya variabler.</p>
<p>Exempelvis kan vi räkna ut hur mycket tid man vunnit om exempelvis flyget landar tidigare än avsett.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="databearbetning.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(flights, <span class="at">beer_time =</span> dep_delay <span class="sc">-</span> arr_delay)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
## #   beer_time &lt;dbl&gt;</code></pre>
<p>I <code>mutate()</code> kan du även använda funktioner såsom <code>mean()</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="databearbetning.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(flights, <span class="at">mean_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
## #   mean_delay &lt;dbl&gt;</code></pre>
<div id="if_else" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> if_else()</h3>
<p>En vanlig funktion i databearbetning är ifelse-satser.</p>
<p>I R gör du det enklast med funktionen <code>if_else()</code> från <code>dplyr</code>. Det finns även en inbyggd funktion som heter <code>ifelse()</code> som mestadels fungerar bra men den från <code>dplyr</code> är något mer stabil.</p>
<p>Du kan använda den i mutate:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="databearbetning.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(flights, försenad <span class="ot">=</span> <span class="fu">if_else</span>(dep_delay  <span class="sc">&gt;</span> <span class="dv">5</span>, <span class="st">&quot;försenad&quot;</span>, <span class="st">&quot;ej försenad&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
## #   försenad &lt;chr&gt;</code></pre>
<p>Ibland vill man göra flera stycken <code>if_else()</code> i samma, exempelvis om man vill dela upp en variabel i flera kategorier beroende på ett logiskt villkor. För att göra det kan du använda funktionen <code>case_when()</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="databearbetning.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(flights, försenad<span class="at">_kat =</span> <span class="fu">case_when</span>(</span>
<span id="cb65-2"><a href="databearbetning.html#cb65-2" aria-hidden="true" tabindex="-1"></a>dep_delay <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;före tid&quot;</span>,</span>
<span id="cb65-3"><a href="databearbetning.html#cb65-3" aria-hidden="true" tabindex="-1"></a>dep_delay <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;i tid&quot;</span>,</span>
<span id="cb65-4"><a href="databearbetning.html#cb65-4" aria-hidden="true" tabindex="-1"></a>dep_delay <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;försenad&quot;</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with 336,766 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
## #   försenad_kat &lt;chr&gt;</code></pre>
</div>
<div id="andra-funktioner" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Andra funktioner</h3>
<p>I <code>mutate()</code> kan du använda de allra flesta funktionerna i R. Här är exempel på några funktioner som kan vara nyttiga i databearbetning:</p>
<ul>
<li>Funktioner för att ranka variabler: <code>rank()</code>, <code>min_rank()</code>, <code>dense_rank()</code>, <code>percent_rank()</code></li>
<li>För att logaritmiska funktioner: <code>log()</code>, <code>log10()</code></li>
<li>För kumulativa beräkningar: <code>cumsum()</code>, <code>cummean()</code></li>
<li>För att bara generera radnummer: <code>row_number()</code></li>
<li>För att ta observation innan eller efter: <code>lead()</code> och <code>lag()</code></li>
<li>För skapa variabler baserat på värde i andra variabler <code>if_else()</code> och <code>case_when()</code></li>
</ul>
</div>
<div id="övningar" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Övningar</h3>
<ol style="list-style-type: decimal">
<li>Skapa en variabel som innehåller den totala förseningen</li>
<li>Rangordna flygens distans. Hur hanterar du fall där distansen är lika lång?</li>
<li>Skapa en variabel som anger om flyget går på våren, hösten, vintern eller sommaren.</li>
</ol>
</div>
</div>
<div id="summarise" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Summarise</h2>
<p>Ofta vill man summera variabler för att få ut intressant information. Exempelvis vill vi här kanske veta en rad medelvärden.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="databearbetning.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(flights, <span class="at">mean_dist =</span> <span class="fu">mean</span>(distance, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   mean_dist
##       &lt;dbl&gt;
## 1     1040.</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="databearbetning.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(flights, <span class="at">sum_dist =</span> <span class="fu">sum</span>(distance, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##    sum_dist
##       &lt;dbl&gt;
## 1 350217607</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="databearbetning.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(flights, <span class="at">count =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##    count
##    &lt;int&gt;
## 1 336776</code></pre>
<p>Men dessa värden är inte så intressanta i sig, utan vi vill kunna göra jämförelse. Då använder vi <code>group_by()</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="databearbetning.html#cb73-1" aria-hidden="true" tabindex="-1"></a>group_by_flights <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flights, carrier)</span>
<span id="cb73-2"><a href="databearbetning.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="databearbetning.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(group_by_flights, </span>
<span id="cb73-4"><a href="databearbetning.html#cb73-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean_air_time =</span> <span class="fu">mean</span>(air_time, <span class="at">na.rm =</span> T),</span>
<span id="cb73-5"><a href="databearbetning.html#cb73-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean_dep_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> T),</span>
<span id="cb73-6"><a href="databearbetning.html#cb73-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean_arr_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 16 x 4
##    carrier mean_air_time mean_dep_delay mean_arr_delay
##    &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
##  1 9E               86.8          16.7           7.38 
##  2 AA              189.            8.59          0.364
##  3 AS              326.            5.80         -9.93 
##  4 B6              151.           13.0           9.46 
##  5 DL              174.            9.26          1.64 
##  6 EV               90.1          20.0          15.8  
##  7 F9              230.           20.2          21.9  
##  8 FL              101.           18.7          20.1  
##  9 HA              623.            4.90         -6.92 
## 10 MQ               91.2          10.6          10.8  
## 11 OO               83.5          12.6          11.9  
## 12 UA              212.           12.1           3.56 
## 13 US               88.6           3.78          2.13 
## 14 VX              337.           12.9           1.76 
## 15 WN              148.           17.7           9.65 
## 16 YV               65.7          19.0          15.6</code></pre>
<p>I <code>summarise()</code> kan du använda en rad olika funktioner såsom <code>sum()</code> för summeringar, <code>median()</code> etc.</p>
<div id="övningar-1" class="section level4" number="3.5.0.1">
<h4><span class="header-section-number">3.5.0.1</span> Övningar</h4>
<ol style="list-style-type: decimal">
<li>Vilken flygplats har högst medelvärde förförseningar från flygplatsen?</li>
<li>Vilken flygplats tar emot minst flyg?</li>
</ol>
</div>
<div id="väv-ihop-verben-med" class="section level4" number="3.5.0.2">
<h4><span class="header-section-number">3.5.0.2</span> Väv ihop verben med %&gt;%</h4>
<p>Med <code>%&gt;%</code> (som kallas för <code>pipe</code> and kan uttalas som <code>and then</code>) kan länka ihop flera uttryck i <em>R</em>. Det gör framför allt din kod mer lättläst.</p>
<p>Med <code>%&gt;%</code> kan du exempelvis först filtrera, sen gruppera och till sist summera, allt i samma uttryck.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="databearbetning.html#cb76-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="databearbetning.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(dep_delay <span class="sc">&lt;</span> <span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="databearbetning.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="databearbetning.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">mean_dep_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 16 x 2
##    carrier mean_dep_delay
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 9E               2.96 
##  2 AA               0.890
##  3 AS              -0.719
##  4 B6               3.26 
##  5 DL               1.76 
##  6 EV               4.65 
##  7 F9               5.09 
##  8 FL               4.72 
##  9 HA              -2.47 
## 10 MQ               1.48 
## 11 OO              -2.88 
## 12 UA               4.33 
## 13 US              -0.744
## 14 VX               2.70 
## 15 WN               6.60 
## 16 YV               2.25</code></pre>
<p>Du läser alltså:
Första tar vi <code>flights</code> <em>and then</em>
filtrerar vi på <code>dep_delay</code> <em>and then</em>
grupperar vi på <code>carrier</code> <em>and then</em>
räknar vi ut medelvärde på <code>dep_delay</code>.</p>
<p>Vilket är mycket mer lättläst än motsvarigheten med parenteser:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="databearbetning.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(</span>
<span id="cb79-2"><a href="databearbetning.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb79-3"><a href="databearbetning.html#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;</span> <span class="dv">60</span>),</span>
<span id="cb79-4"><a href="databearbetning.html#cb79-4" aria-hidden="true" tabindex="-1"></a>    carrier),</span>
<span id="cb79-5"><a href="databearbetning.html#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_dep_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> T))</span></code></pre></div>
</div>
<div id="count" class="section level4" number="3.5.0.3">
<h4><span class="header-section-number">3.5.0.3</span> count()</h4>
<p>Du kan i <code>summarise()</code> räkna antalet observationer med funktionen <code>n()</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="databearbetning.html#cb80-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="databearbetning.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="databearbetning.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 16 x 2
##    carrier count
##    &lt;chr&gt;   &lt;int&gt;
##  1 9E      18460
##  2 AA      32729
##  3 AS        714
##  4 B6      54635
##  5 DL      48110
##  6 EV      54173
##  7 F9        685
##  8 FL       3260
##  9 HA        342
## 10 MQ      26397
## 11 OO         32
## 12 UA      58665
## 13 US      20536
## 14 VX       5162
## 15 WN      12275
## 16 YV        601</code></pre>
<p>Men istället för att göra det här kan du använda funktionen <code>count()</code></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="databearbetning.html#cb83-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="databearbetning.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="databearbetning.html#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>## # A tibble: 16 x 2
## # Groups:   carrier [16]
##    carrier     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 9E      18460
##  2 AA      32729
##  3 AS        714
##  4 B6      54635
##  5 DL      48110
##  6 EV      54173
##  7 F9        685
##  8 FL       3260
##  9 HA        342
## 10 MQ      26397
## 11 OO         32
## 12 UA      58665
## 13 US      20536
## 14 VX       5162
## 15 WN      12275
## 16 YV        601</code></pre>
</div>
</div>
<div id="sample_n" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> sample_n()</h2>
<p>Att göra slumpmässiga urval är en vanlig arbetsuppgift för en data scientist. Det gör du enkelt med <code>sample_n()</code> från <code>dplyr</code>.</p>
<p>Om du vill ta ett slumpmässigt urval om 10 från exempelvis <code>flights</code> gör du bara:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="databearbetning.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(flights, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     4    29     1534           1535        -1     1633           1655
##  2  2013     7    17     1408           1410        -2     1730           1630
##  3  2013     6     1     1740           1745        -5     2009           2047
##  4  2013     5    11     1005           1015       -10     1205           1241
##  5  2013    11    17     1216           1220        -4     1332           1335
##  6  2013    10     8     1458           1505        -7     1856           1830
##  7  2013    12    13     2156           2106        50     2251           2213
##  8  2013     4    20     1930           1935        -5     2040           2100
##  9  2013     1     2      959           1002        -3     1312           1319
## 10  2013    10     3     1646           1655        -9     1836           1840
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Om du istället vill ta ett urval som baseras på <em>procent</em> kan du använda <code>sample_frac</code>, här för <em>0.01%</em></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="databearbetning.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_frac</span>(flights, <span class="fl">0.001</span>)</span></code></pre></div>
<pre><code>## # A tibble: 337 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013    12     4      854            900        -6     1148           1220
##  2  2013    10    23      545            550        -5      930            932
##  3  2013     3    22     1705           1710        -5     2020           2015
##  4  2013     2    18      821            810        11     1050           1043
##  5  2013    12    24     1629           1556        33     1944           1914
##  6  2013     2    16     1850           1855        -5     2108           2141
##  7  2013     4    30       NA           1259        NA       NA           1456
##  8  2013     7     1      659            705        -6      927           1004
##  9  2013    12     7       NA            945        NA       NA           1300
## 10  2013    10     9      854            855        -1     1230           1251
## # … with 327 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="övning-3" class="section level3" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Övning</h3>
<ol style="list-style-type: decimal">
<li>Vilken månad ska du flyga under för att undvika förseningar?</li>
<li>Vilken tid ska du flyga för att undvika förseningar?</li>
<li>Hitta det flygbolag som flyger till flest destinationer, rangordna flygbolagen baserat på den informationen.</li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="eda.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ds-intro-till-r-bok.pdf", "ds-intro-till-r-bok.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
